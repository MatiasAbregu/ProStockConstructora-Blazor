@page "/editar-nota/{numero}"
@using BD.Modelos
@inject NavigationManager Nav



@if (nota == null)
{
    <p>Cargando...</p>
}
else
{
    <div class="d-flex justify-content-center mt-4">
        <div class="card shadow-sm" style="max-width: 500px; width: 100%;">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0 text-center">Editar Nota de Pedido</h5>
            </div>

            <div class="card-body">

                <div class="mb-3">
                    <label class="form-label">Número de nota</label>
                    <input class="form-control" disabled value="@nota.NumeroNotaPedido" />
                </div>

                <div class="mb-3">
                    <label class="form-label">Depósito Origen</label>
                    <select class="form-select" @bind="nota.DepositoOrigenId">
                        @foreach (var d in depositos)
                        {
                            <option value="@d.Id">@($"{d.Id} ({d.Nombre})")</option>
                        }
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Depósito Destino</label>
                    <select class="form-select" @bind="nota.DepositoDestinoId">
                        @foreach (var d in depositos)
                        {
                            <option value="@d.Id">@($"{d.Id} ({d.Nombre})")</option>
                        }
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Fecha de Emisión</label>
                    <input type="date" class="form-control" @bind="fechaEmision" />
                </div>

                <div class="mb-3">
                    <label class="form-label">Estado</label>
                    <select class="form-select" @bind="nota.Estado">
                        <option value="Pendiente">Pendiente</option>
                        <option value="Aprobada">Aprobada</option>
                        <option value="Rechazada">Rechazada</option>
                    </select>
                </div>

                @if (mostrarConfirmacion)
                {
                    <div class="alert alert-success p-2">
                        Cambios guardados correctamente ✔
                    </div>
                }

                <div class="d-flex justify-content-center gap-2 mt-3">
                    <button class="btn btn-primary btn-sm" @onclick="Guardar"> Guardar</button>
                    <button class="btn btn-secondary btn-sm" @onclick="Volver"> Volver</button>
                </div>

            </div>
        </div>
    </div>

       

 

      
}

@code {
    [Parameter] public string? numero { get; set; }

    VerNotaDePedidoDTO? nota;

    protected override async Task OnInitializedAsync()
    {
        nota = new VerNotaDePedidoDTO
        {
            NumeroNotaPedido = numero!,
            DepositoOrigenId = 10,
            DepositoDestinoId = 20,
            FechaEmision = DateTime.Now.AddDays(-3),
            Estado = DTO.Enum.EnumEstadoNotaPedido.Pendiente
        };
    }

    private async Task Guardar()
    {
        mostrarConfirmacion = true;
        StateHasChanged();              
        await Task.Delay(8000);        
        mostrarConfirmacion = false;

       
        Nav.NavigateTo("/notadepedidos");
    }

    void Volver() => Nav.NavigateTo("/notadepedidos");


    private DateTime fechaEmision
    {
        get => nota.FechaEmision;
        set => nota.FechaEmision = value;
    }
}
 

@code {

    List<DepositoDTO> depositos = new()
{
    new DepositoDTO { Id = 10, Nombre = "Depósito Central" },
    new DepositoDTO { Id = 20, Nombre = "Depósito Norte" },
    new DepositoDTO { Id = 12, Nombre = "Depósito Sur" },
    new DepositoDTO { Id = 22, Nombre = "Depósito Oeste" }
};

    class DepositoDTO
    {
        public long Id { get; set; }
        public string Nombre { get; set; } = "";
    }

    bool mostrarConfirmacion = false;

   
}


 
