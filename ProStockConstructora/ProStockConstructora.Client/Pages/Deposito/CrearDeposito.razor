@page "/depositos/crear"
@inject IHttpServicio Http
@inject NavigationManager Navigation

 <div class="card border-0 shadow-sm mb-4">
    <div class="card-body bg-gradient p-4 text-center rounded-3" style="background: linear-gradient(135deg, #0d6efd, #3b8ef3);">
        <h2 class="fw-bold text-Black mb-1" style="font-family: 'Poppins', sans-serif;">
            <i class="bi bi-building-add me-2"></i> Añadir nuevo Depósito
        </h2>
        <p class="text-Black mb-0" style="opacity: 0.9;">
            Completa los datos del depósito y guarda los cambios.
        </p>
    </div>
</div>

<div class="card shadow-sm p-4">
    <EditForm Model="@deposito" OnValidSubmit="@Guardar" FormName="CrearDeposito">
        <DataAnnotationsValidator />
        <ValidationSummary />
        <div class="mb-3">
            <label class="form-label fw-semibold">Código de Depósito</label>
            <InputText class="form-control" @bind-Value="deposito.CodigoDeposito" />
        </div>

        <div class="mb-3">
            <label class="form-label fw-semibold">Nombre del Depósito</label>
            <InputText class="form-control" @bind-Value="deposito.NombreDeposito" />
        </div>

        <div class="mb-3">
            <label class="form-label fw-semibold">Domicilio</label>
            <InputText class="form-control" @bind-Value="deposito.Domicilio" />
        </div>
        <div class="mb-3">
            <label class="form-label fw-semibold">Tipo de Depósito</label>
            <InputSelect class="form-control" @bind-Value="deposito.TipoDeposito">
                @foreach (var tipo in Enum.GetValues(typeof(EnumTipoDeposito)))
                {
                    <option value="@tipo">@tipo</option>
                }
            </InputSelect>
        </div>
        

        <div class="d-flex justify-content-end gap-2 mt-3">
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-save"></i> Guardar
            </button>
            <button type="button" class="btn btn-secondary" @onclick="Volver">
                <i class="bi bi-arrow-left"></i> Volver
            </button>
        </div>
    </EditForm>
</div>

@code {
    [Parameter]
    public long Id { get; set; }
    private DepositoAsociarDTO? deposito = new();
    // private List<VerObraDTO> obras = new();
    string Mensaje = "";

    protected override async Task OnInitializedAsync()
    {
        await CargarDepositos();
        //await CargarObras();
    }
    private async Task CargarDepositos()
    {
        var res = await Http.Get<DepositoAsociarDTO>($"api/deposito/{Id}");
        if (res.Respuesta != null)
        {
            deposito = res.Respuesta;
        }
    }
    
    // private  async Task CargarObras()
    // {
    //     try
    //     {
    //         var res = await Http.Get<Response<List<VerObraDTO>>>($"api/obra/{Id}");
    //         if (res != null && res.Respuesta != null)
    //         {
    //             obras = res.Respuesta.Objeto;
    //         }
    //         else
    //         {
    //             Mensaje = "No se pudieron cargar las obras disponibles.";
    //         }
    //     }
    //     catch (Exception ex)
    //     {
    //         Mensaje = $"Error al cargar obras: {ex.Message}";
    //     }
    // }

    private async Task Guardar()
    {
        try
        {
            var res = await Http.Post<DepositoAsociarDTO, int>("api/deposito", deposito);
            if (res != null && res.Respuesta > 0)
            {
                Navigation.NavigateTo("/deposito");
            }
            else
            {
                Mensaje = "Error al guardar el depósito.";
            }
        }
        catch (Exception ex)
        {
            Mensaje = $"Error al guardar: {ex.Message}";
        }
    }

    private void Volver()
    {
        Navigation.NavigateTo("/deposito");
    }
} 
