@page "/deposito/editar/{id:long}"
@inject IHttpServicio Http
@inject NavigationManager Navigation

<h3 class="text-center my-4 fw-bold text-warning">
    ✏️ Editar Depósito
</h3>
@if (deposito == null)
{
    <div class="text-center">
        <div class="spiner-border text-warning" role="status"><span class="visually-hiden">Cargando...</span>
            </div>
            <p class="mt-2">Cargando informacion del deposito...</p>
    </div>
}
else
{
    <div class="card shadow p-4 mx-auto" style="max-width: 700px;">
        <EditForm Model="@deposito" OnValidSubmit="@Guardar">
            <DataAnnotationsValidator />
            <ValidationSummary />
            <div class="mb-3">
                <label class="form-label fw-semibold">Código de Depósito</label>
                <InputText class="form-control" @bind-Value="deposito.CodigoDeposito" />
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Nombre del Depósito</label>
                <InputText @bind-Value="deposito.NombreDeposito" class="form-control" />
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Tipo de Depósito</label>
                <InputSelect @bind-Value="deposito.TipoDeposito" class="form-select">
                    @foreach (var tipo in Enum.GetValues<EnumTipoDeposito>())
                    {
                        <option value="@tipo">@tipo</option>
                    }
                </InputSelect>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Ubicación</label>
                <InputText @bind-Value="deposito.Ubicacion.UbicacionDomicilio" class="form-control" />
            </div>

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-warning me-2 text-white">
                    <i class="bi bi-save"></i> Guardar
                </button>
                <button type="button" class="btn btn-secondary" @onclick="Volver">
                    <i class="bi bi-arrow-left"></i> Volver
                </button>
            </div>
        </EditForm>
    </div>
}
@code {

    [Parameter]
    public long Id { get; set; }
    // VerDepositoDTO deposito;
    private DepositoAsociarDTO deposito = new DepositoAsociarDTO
    {
        Ubicacion = new UbicacionDTO()
    };
    string Mensaje="";

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        await CargarDepositos(Id);
    }
    private async Task CargarDepositos(long id)
    {
        var res = await Http.Get<DepositoAsociarDTO>($"api/deposito/{id}");

        if (res.Respuesta != null)
        {
            deposito = res.Respuesta;
        }
        else
        {
            deposito = new DepositoAsociarDTO();

        } 
    }
    private async Task Guardar()
    {
        var res = await Http.Put<DepositoAsociarDTO,string>($"api/deposito/actualizar/{deposito.Id}", deposito);
        if (res.Respuesta != null)
        {
            Mensaje = res.Respuesta;
            Navigation.NavigateTo("api/deposito");
        }
        else
        {
            Mensaje = "No se pudo actualizar el deposito";
        }

    }
    private void Volver()
    {
        Navigation.NavigateTo("/deposito");
    }

}
