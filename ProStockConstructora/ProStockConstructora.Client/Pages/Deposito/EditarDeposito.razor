@page "/obras/{ObraId:long}/depositos/editar/{DepositoId:long}"
@inject IHttpServicio Http
@inject NavigationManager Navigation

<h3 class="text-center my-4 fw-bold text-warning">
    ✏️ Editar Depósito
</h3>
@if (deposito == null)
{
    <div class="text-center">
        <div class="spiner-border text-warning" role="status"><span class="visually-hiden">Cargando...</span>
            </div>
            <p class="mt-2">Cargando informacion del deposito...</p>
    </div>
}
else
{
    <div class="card shadow p-4 mx-auto">
        <EditForm Model="@deposito" OnValidSubmit="@Guardar">
            <DataAnnotationsValidator />
            <ValidationSummary />
            <div class="mb-3">
                <label class="form-label fw-semibold">Código de Depósito</label>
                <InputText class="form-control" @bind-Value="deposito.CodigoDeposito" />
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Nombre del Depósito</label>
                <InputText @bind-Value="deposito.NombreDeposito" class="form-control" />
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Domicilio</label>
                <InputText class="form-control" @bind-Value="deposito.Domicilio" />
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Obra asociada</label>
                <InputSelect class="form-select" @bind-Value="deposito.ObraId">
                    <option value="">-- Seleccionar obra --</option>
                    @if (obras != null)
                    {
                        @foreach (var obra in obras)
                        {
                            <option value="@obra.Id">@obra.NombreObra</option>
                        }
                    }
                </InputSelect>
            </div>
            <div class="mb-3">
                <label class="form-label fw-semibold">Tipo de Depósito</label>
                <InputSelect @bind-Value="deposito.TipoDeposito" class="form-select">
                    @foreach (var tipo in Enum.GetValues<EnumTipoDeposito>())
                    {
                        <option value="@tipo">@tipo</option>
                    }
                </InputSelect>
            </div>

            

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-warning me-2 text-white">
                    <i class="bi bi-save"></i> Guardar
                </button>
            </div>
        </EditForm>
    </div>
}
@code {

    [Parameter]
    public long ObraId { get; set; }
    [Parameter]
    public long DepositoId { get; set; }

    private DepositoAsociarDTO deposito = new();
    private List<VerObraDTO> obras = new();
    string Mensaje="";

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        //await CargarDepositos(DepositoId);
    }

    private async Task CargarDeposito(long id)
    {
        var res = await Http.Get<DepositoAsociarDTO>($"api/deposito/{id}");

        if (res.Respuesta != null)
        {
            deposito = res.Respuesta;
        }
    }

    private async Task Guardar()
    {
        var res = await Http.Put<DepositoAsociarDTO,string>($"api/deposito/actualizar/{deposito.Id}", deposito);
        if (res.Respuesta != null)
        {
            Mensaje = res.Respuesta;
            Navigation.NavigateTo("api/deposito");
        }
        else
        {
            Mensaje = "No se pudo actualizar el deposito";
        }

    }
}