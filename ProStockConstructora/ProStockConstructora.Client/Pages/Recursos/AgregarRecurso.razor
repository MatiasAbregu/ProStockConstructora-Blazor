@page "/recursos/agregar-recurso"
@inject IHttpServicio http
@inject NavigationManager navManager

<PageTitle>Agregar Recurso - ProStockConstructora</PageTitle>

<article class="p-4 container">
    <h3 class="fw-bold text-primary mb-4">Agregar Recurso</h3>

    <EditForm Model="@recurso" OnValidSubmit="@CrearRecurso">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <!-- Campo Código ISO -->
        <div class="mb-3">
            <label class="form-label">Código ISO</label>
            <InputText class="form-control" @bind-Value="recurso.CodigoISO" />
            <ValidationMessage For="@(() => recurso.CodigoISO)" />
        </div>

        <!-- Campo Nombre -->
        <div class="mb-3">
            <label class="form-label">Nombre del Recurso</label>
            <InputText class="form-control" @bind-Value="recurso.Nombre" />
            <ValidationMessage For="@(() => recurso.Nombre)" />
        </div>

        <!-- Campo Unidad de Medida -->
        <div class="mb-3">
            <label class="form-label">Unidad de Medida</label>
            <InputSelect class="form-select" @bind-Value="recurso.UnidadMedida">
                <option value="">-- Selecciona una unidad --</option>
                <option value="kg">Kilogramo (kg)</option>
                <option value="m">Metro (m)</option>
                <option value="m2">Metro cuadrado (m²)</option>
                <option value="m3">Metro cúbico (m³)</option>
                <option value="unidad">Unidad</option>
                <option value="litro">Litro (L)</option>
            </InputSelect>
            <ValidationMessage For="@(() => recurso.UnidadMedida)" />
        </div>

        <!-- Botones -->
        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-success">
                <i class="bi bi-check-circle me-1"></i> Crear
            </button>
            <button type="button" class="btn btn-secondary" @onclick="Volver">
                <i class="bi bi-arrow-left-circle me-1"></i> Volver
            </button>
        </div>
    </EditForm>
</article>

@code {
    private RecursosPagPrincipalDTO recurso = new();
    private const int EmpresaId = 1; // Simulación temporal

    private async Task CrearRecurso()
    {
        if (string.IsNullOrWhiteSpace(recurso.Nombre) || string.IsNullOrWhiteSpace(recurso.UnidadMedida))
        {
            await MostrarAlerta("⚠️ Debes completar todos los campos.");
            return;
        }

        // 🔹 En un entorno real se haría un POST al endpoint de creación
        Console.WriteLine($"✅ Recurso creado: {recurso.Nombre} - Unidad: {recurso.UnidadMedida} [Empresa {EmpresaId}]");

        await MostrarAlerta("Recurso creado correctamente (simulación).");

        recurso = new RecursosPagPrincipalDTO(); // limpiar formulario
    }

    private void Volver() => navManager.NavigateTo("/recursos");

    private async Task MostrarAlerta(string mensaje)
    {
        await Task.Run(() => Console.WriteLine(mensaje));
    }
}
